<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>æŠ€æœ¯/ç¬”è®°/ã€Šç¬¬ä¸€è¡Œä»£ç ï¼šAndroidã€‹è¯»ä¹¦ç¬”è®°ï¼ˆä¸‰ï¼‰ - William@blog</title><meta description="Android Kotlin è¯»ä¹¦ç¬”è®°           ç®€ä»‹             &amp;quot;ã€Šç¬¬ä¸€è¡Œä»£ç ï¼šAndroid 3rdã€‹ç¬¬ä¹ç« å’Œç¬¬åç« çš„è¯»ä¹¦ç¬”è®°ï¼Œä¸»è¦å†…å®¹åŒ…æ‹¬å››å¤§ç»„ä»¶ä¸­çš„Serviceä»¥åŠä¸€äº›æ‰‹æœºå¤šåª’ä½“çš„ä½¿ç”¨ã€‚&amp;quot;"><meta property="og:type" content="blog"><meta property="og:title" content="æŠ€æœ¯/ç¬”è®°/ã€Šç¬¬ä¸€è¡Œä»£ç ï¼šAndroidã€‹è¯»ä¹¦ç¬”è®°ï¼ˆä¸‰ï¼‰"><meta property="og:url" content="https://willog.top/posts/87cffae2/"><meta property="og:site_name" content="William@blog"><meta property="og:description" content="Android Kotlin è¯»ä¹¦ç¬”è®°           ç®€ä»‹             &amp;quot;ã€Šç¬¬ä¸€è¡Œä»£ç ï¼šAndroid 3rdã€‹ç¬¬ä¹ç« å’Œç¬¬åç« çš„è¯»ä¹¦ç¬”è®°ï¼Œä¸»è¦å†…å®¹åŒ…æ‹¬å››å¤§ç»„ä»¶ä¸­çš„Serviceä»¥åŠä¸€äº›æ‰‹æœºå¤šåª’ä½“çš„ä½¿ç”¨ã€‚&amp;quot;"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://migrate-1301429536.cos.ap-nanjing.myqcloud.com/img/20201020193149.jpg"><meta property="article:published_time" content="2020-10-16T16:00:00.000Z"><meta property="article:modified_time" content="2022-09-17T07:16:07.967Z"><meta property="article:author" content="Weiliang Bai"><meta property="article:tag" content="Android"><meta property="article:tag" content="Kotlin"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://migrate-1301429536.cos.ap-nanjing.myqcloud.com/img/20201020193149.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://willog.top/posts/87cffae2/"},"headline":"William@blog","image":["https://migrate-1301429536.cos.ap-nanjing.myqcloud.com/img/20201020193149.jpg"],"datePublished":"2020-10-16T16:00:00.000Z","dateModified":"2022-09-17T07:16:07.967Z","author":{"@type":"Person","name":"Weiliang Bai"},"description":"Android Kotlin è¯»ä¹¦ç¬”è®°           ç®€ä»‹             &quot;ã€Šç¬¬ä¸€è¡Œä»£ç ï¼šAndroid 3rdã€‹ç¬¬ä¹ç« å’Œç¬¬åç« çš„è¯»ä¹¦ç¬”è®°ï¼Œä¸»è¦å†…å®¹åŒ…æ‹¬å››å¤§ç»„ä»¶ä¸­çš„Serviceä»¥åŠä¸€äº›æ‰‹æœºå¤šåª’ä½“çš„ä½¿ç”¨ã€‚&quot;"}</script><link rel="canonical" href="https://willog.top/posts/87cffae2/"><link rel="icon" href="/img/favicon_owl/android-chrome-512x512.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?e83fc42ee83404ab3e70b1750dc52ddb";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mermaid@8.8.2/dist/mermaid.min.js"></script><link rel="alternate" href="/atom.xml" title="William@blog" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/William_blog.png" alt="William@blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">ğŸ¡Home</a><a class="navbar-item" href="/archives">ğŸ“Archives</a><a class="navbar-item" href="/categories">ğŸ“ŒCategories</a><a class="navbar-item" href="/gallery">ğŸ¨Gallery</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="xiong35çš„åšå®¢" href="http://www.xiong35.cn"><i class="fa fa-paw"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="lamçš„åšå®¢" href="https://lamcoding.github.io"><i class="fa fa-leaf"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="ç›®å½•" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fa fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="https://migrate-1301429536.cos.ap-nanjing.myqcloud.com/img/20201020193149.jpg" alt="æŠ€æœ¯/ç¬”è®°/ã€Šç¬¬ä¸€è¡Œä»£ç ï¼šAndroidã€‹è¯»ä¹¦ç¬”è®°ï¼ˆä¸‰ï¼‰"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-10-16T16:00:00.000Z" title="2020-10-16T16:00:00.000Z">2020-10-17</time><span class="level-item"><a class="link-muted" href="/categories/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a><span>Â /Â </span><a class="link-muted" href="/categories/%E6%8A%80%E6%9C%AF/%E7%AC%94%E8%AE%B0/">ç¬”è®°</a></span><span class="level-item">20 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 3049 ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile">æŠ€æœ¯/ç¬”è®°/ã€Šç¬¬ä¸€è¡Œä»£ç ï¼šAndroidã€‹è¯»ä¹¦ç¬”è®°ï¼ˆä¸‰ï¼‰</h1><div class="content"><span class="label label-success">Android</span>
<span class="label label-warning">Kotlin</span>
<span class="label label-info">è¯»ä¹¦ç¬”è®°</span>
<br>
<br>
<article class="message">
  <div class="message-header">
    <p>ç®€ä»‹</p>
  </div>
  <div class="message-body">
      <p>"ã€Šç¬¬ä¸€è¡Œä»£ç ï¼šAndroid 3rdã€‹ç¬¬ä¹ç« å’Œç¬¬åç« çš„è¯»ä¹¦ç¬”è®°ï¼Œä¸»è¦å†…å®¹åŒ…æ‹¬å››å¤§ç»„ä»¶ä¸­çš„Serviceä»¥åŠä¸€äº›æ‰‹æœºå¤šåª’ä½“çš„ä½¿ç”¨ã€‚"</p>
  </div>
</article>
<a id="more"></a>
<blockquote>
<p>ä¸ºæ–¹ä¾¿ç¬”è®°ï¼Œçº¦å®šä½¿ç”¨<strong>ä¼ªKotlinè¯­æ³•</strong>ï¼š</p>
<p><code>&lt;!ClassName&gt;</code> ç”¨æ¥è¡¨ç¤ºClassNameç±»çš„ä¸€ä¸ªå®ä¾‹</p>
<p><code>&lt;Abstract&gt;æˆ–&lt;A&gt;</code> å†™åœ¨æ–¹æ³•(ç±»)å‰ç”¨æ¥è¡¨ç¤ºè¯¥æ–¹æ³•ï¼ˆç±»ï¼‰æ˜¯ä¸€ä¸ªå¿…é¡»è¦ç»™å‡ºå®ç°çš„æŠ½è±¡æ–¹æ³•/ç±»</p>
<p><code>&lt;Static&gt;æˆ–&lt;S&gt;</code>å†™åœ¨æ–¹æ³•(ç±»)å‰ç”¨æ¥è¡¨ç¤ºè¯¥æ–¹æ³•ï¼ˆç±»ï¼‰æ˜¯ä¸€ä¸ªé™æ€çš„æ–¹æ³•/ç±»</p>
<p><code>&lt;+&gt;</code> è¡¨ç¤ºpublicæ–¹æ³•</p>
<p><code>O</code> æ˜¯<code>override</code>çš„ç¼©ç•¥</p>
<p><code>XXX</code> è¡¨ç¤ºå¾…å®šçš„è¯­æ³•å­—ç¬¦ä¸²</p>
<p><code>...</code> è¡¨ç¤ºå‰åä»£ç æ®µçœç•¥</p>
<p><strong>UML å›¾</strong>çš„è§„å®šï¼š</p>
<p>æ–œä½“å‡½æ•°*ä¸ºæŠ½è±¡å‡½æ•°</p>
<p>ä¸‹åˆ’çº¿å‡½æ•°$ä¸ºé™æ€å‡½æ•°</p>
<p>ä»¥ä¸‹å‰ç¼€ä»£è¡¨è®¿é—®æƒé™</p>
<ul>
<li><code>+</code> Public</li>
<li><code>-</code> Private</li>
<li><code>#</code> Protected</li>
<li><code>~</code> Package/Internal</li>
</ul>
</blockquote>
<h2 id="ä¸°å¯Œå¤šå½©çš„å¤šåª’ä½“"><a class="markdownIt-Anchor" href="#ä¸°å¯Œå¤šå½©çš„å¤šåª’ä½“"></a> ä¸°å¯Œå¤šå½©çš„å¤šåª’ä½“</h2>
<h3 id="ä½¿ç”¨é€šçŸ¥"><a class="markdownIt-Anchor" href="#ä½¿ç”¨é€šçŸ¥"></a> ä½¿ç”¨é€šçŸ¥</h3>
<h4 id="æ¦‚è§ˆ"><a class="markdownIt-Anchor" href="#æ¦‚è§ˆ"></a> æ¦‚è§ˆ</h4>
<div class="mermaid">
    classDiagram
      class NotificationManager {
      +notify()
      +createNotificationChannel()
      }
      class NotificationChannel
      class NotificationCompat {
      +Builder()
      }
      NotificationCompat --> Notification: åˆ›å»º
      NotificationManager --> NotificationChannel: åˆ›å»ºã€ç®¡ç†
      NotificationManager --> Notification: å‘é€
      Notification --* NotificationChannel: å¯¹åº”
</div>
<h4 id="notificationmanager-ç±»"><a class="markdownIt-Anchor" href="#notificationmanager-ç±»"></a> NotificationManager ç±»</h4>
<ul>
<li>åˆ›å»ºï¼š<code>val manager = getSystemService(Context.NOTIFICATION_SERVICE) as NotifictionManager</code>
<ul>
<li>å¤‡æ³¨ï¼š<code>getSystemService()</code> æ˜¯ <code>Context</code> çš„ä¸€ä¸ªç”¨æ¥è·å–ç³»ç»ŸæœåŠ¡æ–¹æ³•ã€‚</li>
</ul>
</li>
</ul>
<h4 id="notificationchannel-ç±»"><a class="markdownIt-Anchor" href="#notificationchannel-ç±»"></a> NotificationChannel ç±»</h4>
<blockquote>
<p>æ¯æ¡é€šçŸ¥éƒ½è¦å±äºä¸€ä¸ªå¯¹åº”çš„æ¸ é“ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å¯ä»¥è‡ªç”±åœ°åˆ›å»ºå½“å‰åº”ç”¨æ‹¥æœ‰å“ªäº›é€šçŸ¥æ¸ é“ï¼Œä½†æ˜¯è¿™äº›é€šçŸ¥æ¸ é“çš„æ§åˆ¶æƒæ˜¯æŒæ¡åœ¨ç”¨æˆ·æ‰‹ä¸Šçš„ã€‚ç”¨æˆ·å¯ä»¥è‡ªç”±åœ°é€‰æ‹©è¿™äº›é€šçŸ¥æ¸ é“çš„é‡è¦ç¨‹åº¦ï¼Œæ˜¯å¦å“é“ƒã€æ˜¯å¦æŒ¯åŠ¨æˆ–è€…æ˜¯å¦è¦å…³é—­è¿™ä¸ªæ¸ é“çš„é€šçŸ¥ã€‚</p>
</blockquote>
<figure class="highlight kotlin"><figcaption><span>åˆ›å»ºé€šçŸ¥æ¸ é“</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;	<br><span class="hljs-comment">// é€šçŸ¥æ¸ é“æ˜¯v8.0æ–°å¢çš„APIï¼Œéœ€è¦åšä¸‹ç‰ˆæœ¬åˆ¤åˆ«æ‰èƒ½ä½¿ç”¨NotificationChannel</span><br>    <span class="hljs-keyword">val</span> channel = NotificationChannel(channelId: String, channelName: String, importance)<br>    <span class="hljs-comment">//æ„é€ é€šçŸ¥æ¸ é“å®ä¾‹                    æ¸ é“æ ‡è¯†ä¸²          å‘ç”¨æˆ·æ˜¾ç¤ºçš„æ¸ é“åç§°    é‡è¦ç­‰çº§</span><br>    <br>    &lt;!NotificationManager&gt;.createNotificationChannel(channel)<br>    <span class="hljs-comment">//åˆ›å»ºé€šçŸ¥æ¸ é“                                        </span><br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>é€šçŸ¥æ¸ é“é‡è¦ç­‰çº§ï¼š<code>IMPORTANCE_HIGH</code>ã€<code>IMPORTANCE_DEFAULT</code>ã€<code>IMPORTANCE_LOW</code>ã€<code>IMPORTANCE_MIN</code>ï¼Œç”¨ä¸åŒlevelæ„é€ çš„channelä¼šæœ‰ä¸åŒçš„è¡¨ç°ï¼Œå¦‚HIGHçº§åˆ«çš„æ¸ é“ä¼šå¼¹å‡ºé€šçŸ¥ã€‚</li>
</ul>
<h4 id="notification-ç±»"><a class="markdownIt-Anchor" href="#notification-ç±»"></a> Notification ç±»</h4>
<ul>
<li>å¯ä»¥åœ¨ Activityï¼ˆè¾ƒå°‘ï¼‰ã€Broadcastã€Service ä¸­åˆ›å»º</li>
</ul>
<figure class="highlight kotlin"><figcaption><span>é€šçŸ¥ã®æ„å»ºä¸å‘é€</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//ç”¨AndroidXåº“çš„NotificationCompatç±»æ¥æ„å»ºé€šçŸ¥è¦æ¯”åŸAPIå…¼å®¹æ€§æ›´å¥½</span><br><span class="hljs-keyword">val</span> notification = NotificationCompat.Builder(context, channelId: String)<span class="hljs-comment">//é€šçŸ¥è¦å¯¹åº”å”¯ä¸€ä¸€ä¸ªchannel</span><br>        .setContentTitle(title: String)<br>        .setContentText(text: String)<br>		.setContentIntent(pi: PendingIntent)<span class="hljs-comment">//ç‚¹å‡»äº‹ä»¶</span><br>        .setSmallIcon(R.drawable.small_icon)<br>        .setLargeIcon(BitmapFactory.decodeResource(getResources(), R.drawable.large_icon))<br>		.setAutoCancel(<span class="hljs-literal">true</span>)<span class="hljs-comment">//ç‚¹å‡»é€šçŸ¥åé€šçŸ¥æ¶ˆå¤±</span><br>        <span class="hljs-comment">//å¯ä»¥è¿ç¼€å¤šä¸ªsetæ–¹æ³•æ¥èµ‹äºˆé€šçŸ¥å„ç§å±æ€§</span><br>        .build()<span class="hljs-comment">//æ„å»º</span><br>        <br><span class="hljs-comment">//é€šè¿‡ç®¡ç†å™¨å‘é€</span><br>&lt;!NotificationManager&gt;.notify(id: <span class="hljs-built_in">Int</span>, notification: Notification)<br><span class="hljs-comment">//							  é€šçŸ¥çš„æ ‡è¯†ç¬¦    é€šçŸ¥</span><br></code></pre></td></tr></table></figure>
<ul>
<li>é€šçŸ¥å±æ€§(è¿›é˜¶)ï¼š<code>.setStyle()</code> æ–¹æ³•â€”â€”è®©é€šçŸ¥å‘ˆç°å¯Œæ–‡æœ¬</li>
</ul>
<div class="mermaid">flowchart TD
	Style --> BigPictureStyle;
	Style --> BigTextStyle</div>
<figure class="highlight kotlin"><figcaption><span>setStyle ä¸¾ä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å¤§å›¾ç‰‡</span><br>.setStyle(NotificationCompat.BigPictureStyle().bigPicture(<br>		BitmapFactory.decodeResource(resources, R.drawable.big_image)))<br><span class="hljs-comment">//é•¿æ–‡å­—</span><br>.setStyle( NotificationCompat.BigTextStyle().bigText(string: String) )<br></code></pre></td></tr></table></figure>
<h4 id="ç‚¹å‡»äº‹ä»¶"><a class="markdownIt-Anchor" href="#ç‚¹å‡»äº‹ä»¶"></a> ç‚¹å‡»äº‹ä»¶</h4>
<ul>
<li>ä¸ºé€šçŸ¥è®¾ç½®ç‚¹å‡»äº‹ä»¶ï¼š<code>.setContentIntent(pi: PendingIntent)</code></li>
</ul>
<figure class="highlight kotlin"><figcaption><span>æ„å»ºPendingIntent</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">&lt;S&gt; PendingIntent.getXXX(ctx: Context, <span class="hljs-number">0</span>, intent: Intent, flag: <span class="hljs-built_in">Int</span>): PendingIntent<br><span class="hljs-comment">//para4ç”¨äºç¡®å®šPendingIntentçš„è¡Œä¸ºï¼Œä¸€èˆ¬å¯å–0è¯¦ï¼Œæƒ…æŸ¥æ–‡æ¡£</span><br><span class="hljs-comment">//XXXå¯ä»¥æ˜¯Activityã€Broadcastã€Service</span><br></code></pre></td></tr></table></figure>
<h3 id="è°ƒç”¨æ‘„åƒå¤´ä¸ç›¸å†Œ"><a class="markdownIt-Anchor" href="#è°ƒç”¨æ‘„åƒå¤´ä¸ç›¸å†Œ"></a> è°ƒç”¨æ‘„åƒå¤´ä¸ç›¸å†Œ</h3>
<h4 id="from-camera"><a class="markdownIt-Anchor" href="#from-camera"></a> From Camera</h4>
<div class="mermaid">
flowchart TB
    A[fa:fa-camera-retro intentæœºåˆ¶å‘¼å‡ºç›¸æœºæ‹ç…§]
	è·å–å¯¹åº”çš„Uriå¯¹è±¡ --> ç»™intentä¼ å…¥UriæŒ‡å®šç›¸ç‰‡å°†å†™å…¥çš„æ–‡ä»¶
	A --> å°†æ‹æ‘„çš„ç…§ç‰‡æ˜¾ç¤ºå‡ºæ¥
	åˆ›å»ºå¯¹åº”è·¯å¾„çš„Fileå¯¹è±¡ --> è·å–å¯¹åº”çš„Uriå¯¹è±¡
	ç»™intentä¼ å…¥UriæŒ‡å®šç›¸ç‰‡å°†å†™å…¥çš„æ–‡ä»¶ --> A
</div>
<figure class="highlight kotlin"><figcaption><span>ç›¸æœºå®ä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() &#123;<br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> imageUri: Uri<br>    <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> outputImage: File<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br>        <br>        <span class="hljs-comment">//step1</span><br>        outputImage = File(externalCacheDir, <span class="hljs-string">"output_image.jpg"</span>)<br>        <span class="hljs-keyword">if</span> (outputImage.exists()) &#123;<br>            outputImage.delete()<br>        &#125;<br>        outputImage.createNewFile()<br>        <br>        <span class="hljs-comment">//step2</span><br>        imageUri = <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;<br>            FileProvider.getUriForFile(<span class="hljs-keyword">this</span>, <span class="hljs-string">"com.example.cameraalbumtest.fileprovider"</span>, outputImage)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            Uri.fromFile(outputImage)<br>        &#125;<span class="hljs-comment">//ä»Android 7.0ç³»ç»Ÿå¼€å§‹ï¼Œç›´æ¥ä½¿ç”¨æœ¬åœ°çœŸå®è·¯å¾„çš„Uriè¢«è®¤ä¸ºæ˜¯ä¸å®‰å…¨çš„ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªFileUriExposedExceptionå¼‚å¸¸ã€‚</span><br>        <span class="hljs-comment">//è€ŒFileProvideråˆ™æ˜¯ä¸€ç§ç‰¹æ®Šçš„ContentProviderï¼Œå®ƒå¯ä»¥é€‰æ‹©æ€§åœ°å°†å°è£…è¿‡çš„Uriå…±äº«ç»™å¤–éƒ¨ï¼Œä»è€Œæé«˜äº†åº”ç”¨çš„å®‰å…¨æ€§ã€‚</span><br><br>        <span class="hljs-comment">//step3~4</span><br>        <span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-string">"android.media.action.IMAGE_CAPTURE"</span>)<br>        intent.putExtra(MediaStore.EXTRA_OUTPUT, imageUri)<br>        startActivityForResult(intent, takePhoto)<br>    &#125;<br><br>    <span class="hljs-comment">//step5</span><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onActivityResult</span><span class="hljs-params">(requestCode: <span class="hljs-type">Int</span>, resultCode: <span class="hljs-type">Int</span>, <span class="hljs-keyword">data</span>: <span class="hljs-type">Intent</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="hljs-keyword">data</span>)<br>        <span class="hljs-keyword">when</span> (requestCode) &#123;<br>            takePhoto -&gt; &#123;<br>                <span class="hljs-keyword">if</span> (resultCode == Activity.RESULT_OK) &#123;<span class="hljs-keyword">val</span> bitmap = BitmapFactory.decodeStream(contentResolver.openInputStream(imageUri))<br>                    imageView.setImageBitmap( bitmap)<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li>ä»£ç ä¸­ç”¨åˆ°<code>&quot;com.example.cameraalbumtest.fileprovider&quot;</code>ï¼Œéœ€è¦åœ¨Manifestä¸­æ³¨å†Œã€‚</li>
</ul>
<figure class="highlight xml"><figcaption><span>fileprovideræ³¨å†Œç¤ºä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">provider</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:name</span>=<span class="hljs-string">"androidx.core.content.FileProvider"</span>	//å›ºå®šä¸å˜</span><br><span class="hljs-tag">    <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"com.example.cameraalbumtest.fileprovider"</span>	//ä¸<span class="hljs-attr">FileProvider.getUriForFile</span>()ç¬¬äºŒä¸ªå‚æ•°ä¸€è‡´</span><br><span class="hljs-tag">    <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"false"</span>	//æ˜¯å¦å…è®¸å¤–éƒ¨ä½¿ç”¨</span><br><span class="hljs-tag">    <span class="hljs-attr">android:grantUriPermissions</span>=<span class="hljs-string">"true"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>	//æŒ‡å®š<span class="hljs-attr">Uri</span>å…±äº«è·¯å¾„</span><br><span class="hljs-tag">        <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.support.FILE_PROVIDER_PATHS"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:resource</span>=<span class="hljs-string">"@xml/file_paths"</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">provider</span>&gt;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight xml"><figcaption><span>res/xml/file_paths.xmlæ–‡ä»¶ç¤ºä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">paths</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">external-path</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"my_images"</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> /&gt;</span><br>    //                   éšæ„       æŒ‡å®šå…±äº«ç›®å½•<br><span class="hljs-tag">&lt;/<span class="hljs-name">paths</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h4 id="from-album"><a class="markdownIt-Anchor" href="#from-album"></a> From Album</h4>
<div class="mermaid">
flowchart LR
	å‘é€è¯·æ±‚Intent-->æ¥å—å¹¶å¤„ç†ç»“æœResult
</div>
<figure class="highlight kotlin"><figcaption><span>ç›¸ç°¿ç¤ºä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-comment">//*step1</span><br>        <span class="hljs-keyword">val</span> intent = Intent(Intent.ACTION_OPEN_DOCUMENT)<br>        intent.addCategory(Intent.CATEGORY_OPENABLE) <br>        intent.type = <span class="hljs-string">"image/*"</span><br>        <br>        startActivityForResult(intent, fromAlbum)<br>    &#125;<br><br>    <span class="hljs-comment">//step2</span><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onActivityResult</span><span class="hljs-params">(requestCode: <span class="hljs-type">Int</span>, resultCode: <span class="hljs-type">Int</span>, <span class="hljs-keyword">data</span>: <span class="hljs-type">Intent</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="hljs-keyword">data</span>)<br>        <span class="hljs-keyword">when</span> (requestCode) &#123;<br>            fromAlbum -&gt; &#123;<br>                <span class="hljs-keyword">if</span> (resultCode == Activity.RESULT_OK &amp;&amp; <span class="hljs-keyword">data</span> != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">data</span>.<span class="hljs-keyword">data</span>?.let &#123; uri -&gt;<br>                        <span class="hljs-keyword">val</span> bitmap = getBitmapFromUri(uri)<br>                        imageView.setImageBitmap(bitmap)<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>
<h3 id="æ’­æ”¾å¤šåª’ä½“æ–‡ä»¶"><a class="markdownIt-Anchor" href="#æ’­æ”¾å¤šåª’ä½“æ–‡ä»¶"></a> æ’­æ”¾å¤šåª’ä½“æ–‡ä»¶</h3>
<h4 id="éŸ³é¢‘æ¦‚è§ˆ"><a class="markdownIt-Anchor" href="#éŸ³é¢‘æ¦‚è§ˆ"></a> éŸ³é¢‘æ¦‚è§ˆ</h4>
<div class="mermaid">
classDiagram
class Activity {
	getAssets();
}
class AssetManager {
	+openFd();
}
class MediaPlayer {
	+setDataSource();
	+prepare();
}
Activity-->AssetManager: åˆ›å»º
AssetManager-->MediaPlayer: æä¾›æ’­æ”¾èµ„æº
</div>
<h4 id="mediaplayer-ç±»"><a class="markdownIt-Anchor" href="#mediaplayer-ç±»"></a> MediaPlayer ç±»</h4>
<blockquote>
<p>MediaPlayer å¯ä»¥ç”¨äºæ’­æ”¾<strong>ç½‘ç»œã€æœ¬åœ°ã€appå®‰è£…åŒ…ä¸­çš„éŸ³é¢‘</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th><strong>æ–¹æ³•å</strong></th>
<th><strong>åŠŸèƒ½æè¿°</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>setDataSource()</td>
<td>è®¾ç½®è¦æ’­æ”¾çš„éŸ³é¢‘æ–‡ä»¶çš„ä½ç½®</td>
</tr>
<tr>
<td>prepare()</td>
<td>åœ¨å¼€å§‹æ’­æ”¾ä¹‹å‰è°ƒç”¨ï¼Œä»¥å®Œæˆå‡†å¤‡å·¥ä½œ</td>
</tr>
<tr>
<td>start()</td>
<td>å¼€å§‹æˆ–ç»§ç»­æ’­æ”¾éŸ³é¢‘</td>
</tr>
<tr>
<td>pause()</td>
<td>æš‚åœæ’­æ”¾éŸ³é¢‘</td>
</tr>
<tr>
<td>reset()</td>
<td>å°†MediaPlayerå¯¹è±¡é‡ç½®åˆ°åˆšåˆšåˆ›å»ºçš„çŠ¶æ€</td>
</tr>
<tr>
<td>seekTo()</td>
<td>ä»æŒ‡å®šçš„ä½ç½®å¼€å§‹æ’­æ”¾éŸ³é¢‘</td>
</tr>
<tr>
<td>stop()</td>
<td>åœæ­¢æ’­æ”¾éŸ³é¢‘ã€‚è°ƒç”¨åçš„MediaPlayerå¯¹è±¡æ— æ³•å†æ’­æ”¾éŸ³é¢‘</td>
</tr>
<tr>
<td>release()</td>
<td>é‡Šæ”¾ä¸MediaPlayerå¯¹è±¡ç›¸å…³çš„èµ„æº</td>
</tr>
<tr>
<td>isPlaying()</td>
<td>åˆ¤æ–­å½“å‰MediaPlayeræ˜¯å¦æ­£åœ¨æ’­æ”¾éŸ³é¢‘</td>
</tr>
<tr>
<td>getDuration()</td>
<td>è·å–è½½å…¥çš„éŸ³é¢‘æ–‡ä»¶çš„æ—¶é•¿</td>
</tr>
</tbody>
</table>
<h4 id="assetmanager-ç±»"><a class="markdownIt-Anchor" href="#assetmanager-ç±»"></a> AssetManager ç±»</h4>
<blockquote>
<p><code>app/src/main/assets</code> å†…çš„æ–‡ä»¶å’Œå­ç›®å½•åœ¨é¡¹ç›®æ‰“åŒ…æ—¶ä¼šä¸€å¹¶æ‰“åŒ…åˆ°å®‰è£…æ–‡ä»¶ä¸­ã€‚</p>
<p><code>AssetManager</code> å°±æ˜¯ç”¨æ¥ç®¡ç†<code>asset</code>å†…æ–‡ä»¶çš„å·¥å…·ç±»</p>
</blockquote>
<h4 id="éŸ³é¢‘ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#éŸ³é¢‘ç¤ºä¾‹"></a> éŸ³é¢‘ç¤ºä¾‹</h4>
<figure class="highlight kotlin"><figcaption><span>æ’­æ”¾å®‰è£…åŒ…å†…éŸ³é¢‘</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mediaPlayer = MediaPlayer()<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br>        initMediaPlayer()<br>        play.setOnClickListener &#123;<br>            <span class="hljs-keyword">if</span> (!mediaPlayer.isPlaying) &#123;<br>                mediaPlayer.start() <span class="hljs-comment">// å¼€å§‹æ’­æ”¾</span><br>            &#125;<br>        &#125;<br>        pause.setOnClickListener &#123;<br>            <span class="hljs-keyword">if</span> (mediaPlayer.isPlaying) &#123;<br>                mediaPlayer.pause() <span class="hljs-comment">// æš‚åœæ’­æ”¾</span><br>            &#125;<br>        &#125;<br>        stop.setOnClickListener &#123;<br>            <span class="hljs-keyword">if</span> (mediaPlayer.isPlaying) &#123;<br>                mediaPlayer.reset() <span class="hljs-comment">// åœæ­¢æ’­æ”¾</span><br>                initMediaPlayer()<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initMediaPlayer</span><span class="hljs-params">()</span></span> &#123;<br>        <span class="hljs-keyword">val</span> assetManager = assets<br>        <span class="hljs-keyword">val</span> fd = assetManager.openFd(<span class="hljs-string">"music.mp3"</span>)<br>        mediaPlayer.setDataSource(fd.fileDescriptor, fd.startOffset, fd.length) <br>        mediaPlayer.prepare()<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onDestroy()<br>        mediaPlayer.stop()<br>        mediaPlayer.release()<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="è§†é¢‘æ¦‚è®º"><a class="markdownIt-Anchor" href="#è§†é¢‘æ¦‚è®º"></a> è§†é¢‘æ¦‚è®º</h4>
<p>VideoView ç±»å®é™…ä¸Šæ˜¯åœ¨MediaPlayerä¸Šçš„ä¸€å±‚å°è£…ã€‚</p>
<p>æ³¨æ„VideoViewä¸æ”¯æŒæ’­æ”¾assetæ–‡ä»¶ï¼Œä½†å¯ä»¥æ’­æ”¾<code>app/src/main/res/raw</code>ä¸‹çš„æ–‡ä»¶ï¼ˆæƒ³åˆ°VideoViewæ˜¯ä¸€ç§Viewå°±ä¸éš¾ç†è§£ï¼‰ã€‚</p>
<p>æ³¨æ„VideoViewä¸é€‚åˆåšåŠŸèƒ½å¼ºå¤§çš„è§†é¢‘æ’­æ”¾å™¨ã€‚</p>
<h4 id="è§†é¢‘å®ä¾‹"><a class="markdownIt-Anchor" href="#è§†é¢‘å®ä¾‹"></a> è§†é¢‘å®ä¾‹</h4>
<figure class="highlight xml"><figcaption><span>VideoViewæ§ä»¶</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">VideoView</span></span><br><span class="hljs-tag">           <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@id+videoView"</span></span><br><span class="hljs-tag">           <span class="hljs-attr">...layout_width</span>=<span class="hljs-string">...</span></span><br><span class="hljs-tag">           <span class="hljs-attr">...layout_height</span>=<span class="hljs-string">...</span></span><br><span class="hljs-tag">           <span class="hljs-attr">...</span> /&gt;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight kotlin"><figcaption><span>VideoViewç±»</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/*class MainActivity : AppCompatActivity() &#123;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="hljs-comment">        super.onCreate(savedInstanceState)</span><br><span class="hljs-comment">        setContentView(R.layout.activity_main)*/</span><br>        <br>        <span class="hljs-keyword">val</span> uri = Uri.parse(<span class="hljs-string">"android.resource://<span class="hljs-variable">$packageName</span>/<span class="hljs-subst">$&#123;R.raw.video&#125;</span>"</span>)<br>		<span class="hljs-comment">//ç•™æ„èµ„æºURIå­—ç¬¦ä¸²æ ¼å¼</span><br>        videoView.setVideoURI(uri)<br>        <br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        play.setOnClickListener &#123;</span><br><span class="hljs-comment">            if (!videoView.isPlaying) &#123;</span><br><span class="hljs-comment">                videoView.start() // å¼€å§‹æ’­æ”¾</span><br><span class="hljs-comment">            &#125;</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">        pause.setOnClickListener &#123;</span><br><span class="hljs-comment">            if (videoView.isPlaying) &#123;</span><br><span class="hljs-comment">                videoView.pause() // æš‚åœæ’­æ”¾</span><br><span class="hljs-comment">            &#125;</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">        replay.setOnClickListener &#123;</span><br><span class="hljs-comment">            if (videoView.isPlaying) &#123;</span><br><span class="hljs-comment">                videoView.resume() // é‡æ–°æ’­æ”¾</span><br><span class="hljs-comment">            &#125;</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">    &#125;*/</span><br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onDestroy()<br>        videoView.<span class="hljs-keyword">suspend</span>()<span class="hljs-comment">//é‡Šæ”¾VideoViewå ç”¨çš„èµ„æº</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="åå°é»˜é»˜åŠ³åŠ¨è€…-service"><a class="markdownIt-Anchor" href="#åå°é»˜é»˜åŠ³åŠ¨è€…-service"></a> åå°é»˜é»˜åŠ³åŠ¨è€… Service</h2>
<h3 id="å®‰å“å¤šçº¿ç¨‹"><a class="markdownIt-Anchor" href="#å®‰å“å¤šçº¿ç¨‹"></a> å®‰å“å¤šçº¿ç¨‹</h3>
<h4 id="kotlin-å¤šçº¿ç¨‹ç¼–ç¨‹"><a class="markdownIt-Anchor" href="#kotlin-å¤šçº¿ç¨‹ç¼–ç¨‹"></a> Kotlin å¤šçº¿ç¨‹ç¼–ç¨‹</h4>
<figure class="highlight kotlin"><figcaption><span>kotlinåˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1. ç»§æ‰¿é‡å†™Thread()</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span>: <span class="hljs-type">Thread</span></span>() &#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> &#123;...&#125;<br>&#125;<br>MyThread.start()<br><br><span class="hljs-comment">//2-1. ç”¨æ¥å£æ„é€ Thread()</span><br>Thread(<span class="hljs-keyword">object</span>: Runnable &#123;	<span class="hljs-comment">//æ³¨æ„è¿™é‡Œæ˜¯åŒ¿åå†…éƒ¨ç±»çš„å†™æ³•</span><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> &#123;...&#125;<br>&#125;).start()<br><br><span class="hljs-comment">//2-2. kotlinå•æŠ½è±¡æ–¹æ³•æ¥å£ã®ç®€åŒ–ç‰ˆ</span><br>Thread&#123;<span class="hljs-comment">/*Lambda*/</span>&#125;.start()<br><br><span class="hljs-comment">//3. ç”¨kotlinå†…ç½®é¡¶å±‚å‡½æ•°</span><br>thread &#123;<br>    <span class="hljs-comment">//logic</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶"><a class="markdownIt-Anchor" href="#å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶"></a> å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶</h4>
<blockquote>
<p>Android åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­æ”¹UIï¼Œå› æ­¤åœ¨å­çº¿ç¨‹ä¸­æƒ³è¦è¿›è¡ŒUIæ“ä½œå°±éœ€è¦å¼‚æ­¥æœºåˆ¶</p>
</blockquote>
<img src="https://migrate-1301429536.cos.ap-nanjing.myqcloud.com/img/20200916163550.png" alt="å›¾10-1 Android å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶" style="zoom:90%;" />
<ul>
<li>Messageæ˜¯åœ¨çº¿ç¨‹ä¹‹é—´ä¼ é€’çš„æ¶ˆæ¯ï¼Œå®ƒå¯ä»¥åœ¨å†…éƒ¨æºå¸¦å°‘é‡çš„ä¿¡æ¯ï¼Œç”¨äºåœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®ã€‚</li>
<li>Handlerä¸»è¦ç”¨äºå‘é€å’Œå¤„ç†æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯ä¸€èˆ¬æ˜¯ä½¿ç”¨Handlerçš„sendMessage()æ–¹æ³•ã€post()æ–¹æ³•ç­‰ï¼Œè€Œå‘å‡ºçš„æ¶ˆæ¯ç»è¿‡ä¸€ç³»åˆ—åœ°è¾—è½¬å¤„ç†åï¼Œæœ€ç»ˆä¼šä¼ é€’åˆ°Handlerçš„handleMessage()æ–¹æ³•ä¸­ã€‚</li>
<li>MessageQueueæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æ„æ€ï¼Œå®ƒä¸»è¦ç”¨äºå­˜æ”¾æ‰€æœ‰é€šè¿‡Handlerå‘é€çš„æ¶ˆæ¯ã€‚è¿™éƒ¨åˆ†æ¶ˆæ¯ä¼šä¸€ç›´å­˜åœ¨äºæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«å¤„ç†ã€‚æ¯ä¸ªçº¿ç¨‹ä¸­åªä¼šæœ‰ä¸€ä¸ªMessageQueueå¯¹è±¡ã€‚</li>
<li>Looperæ˜¯æ¯ä¸ªçº¿ç¨‹ä¸­çš„MessageQueueçš„ç®¡å®¶ï¼Œè°ƒç”¨Looperçš„loop()æ–¹æ³•åï¼Œå°±ä¼šè¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯å½“ä¸­ï¼Œç„¶åæ¯å½“å‘ç°MessageQueueä¸­å­˜åœ¨ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œå°±ä¼šå°†å®ƒå–å‡ºï¼Œå¹¶ä¼ é€’åˆ°Handlerçš„handleMessage()æ–¹æ³•ä¸­ã€‚æ¯ä¸ªçº¿ç¨‹ä¸­åªä¼šæœ‰ä¸€ä¸ªLooperå¯¹è±¡ã€‚</li>
</ul>
<figure class="highlight kotlin"><figcaption><span>å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶å®ä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() &#123;<br><br>    <span class="hljs-keyword">val</span> updateText = <span class="hljs-number">1</span><br><br>    <span class="hljs-comment">//åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªHandlerå¯¹è±¡ï¼Œå½“æ¥æ”¶åˆ°Messageæ—¶è¯¥å¯¹è±¡çš„.handleMessage()å°±èƒ½åœ¨ä¸»çº¿ç¨‹ä¸­è¢«è°ƒç”¨</span><br>    <span class="hljs-keyword">val</span> handler = <span class="hljs-keyword">object</span> : Handler() &#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleMessage</span><span class="hljs-params">(msg: <span class="hljs-type">Message</span>)</span></span> &#123;<br>            <span class="hljs-comment">// åœ¨è¿™é‡Œå¯ä»¥è¿›è¡ŒUIæ“ä½œ</span><br>            <span class="hljs-keyword">when</span> (msg.what) &#123;<br>                updateText -&gt; textView.text = <span class="hljs-string">"Nice to meet you"</span><br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br>        changeTextBtn.setOnClickListener &#123;<br>            thread &#123;<br>                <span class="hljs-keyword">val</span> msg = Message()<br>                msg.what = updateText<br>                handler.sendMessage(msg) <span class="hljs-comment">// åœ¨å­çº¿ç¨‹å°†Messageå¯¹è±¡å‘é€å‡ºå»</span><br>            &#125;<br>        &#125;<br>    &#125;<br><span class="hljs-comment">//ä¸€è¶Ÿä¸‹æ¥Messageä»å­çº¿ç¨‹è¾—è½¬åˆ°äº†ä¸»çº¿ç¨‹</span><br>&#125;<br></code></pre></td></tr></table></figure>
<div class="mermaid">
classDiagram
class Message {
	Int what
	Int arg1
	Int arg2
	Object obj
}
class Handler {
	+sendMessage(Message m)
	+post()
	+handleMessage(Message m)*
}
Handler --> Message: å‘é€
Message --> Handler: å¤„ç†
</div>
<h4 id="asynctask-ç±»"><a class="markdownIt-Anchor" href="#asynctask-ç±»"></a> AsyncTask ç±»</h4>
<ul>
<li>é‡å†™å››ä¸ªæ–¹æ³•ï¼Œ<code>.execute()</code>å¯åŠ¨</li>
</ul>
<figure class="highlight kotlin"><figcaption><span>è§£æAsyncTaskç±»</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">&lt;A&gt; AsyncTask&lt;paramsType, progressType, resultType&gt; &#123;<br><span class="hljs-comment">//æ³¨æ„ä¸‰ä¸ªæ³›å‹ï¼šå‚æ•°ç±»å‹      è¿›åº¦ç±»å‹        ç»“æœç±»å‹</span><br>    &lt;A&gt; onPreExecute()	<span class="hljs-comment">//åå°å¼€å¯å‰çš„åˆå§‹åŒ–ä»»åŠ¡</span><br>    &lt;A&gt; doInBackground(paramsType...)	<span class="hljs-comment">//åå°ä»»åŠ¡ï¼šåœ¨å­çº¿ç¨‹ä¸­è¿è¡Œ</span><br>    &lt;A&gt; onProgressUpdate(progressType...)	<span class="hljs-comment">//åå°publishProgress(progressType...)åæ‰§è¡Œï¼ˆé€šå¸¸åœ¨è¿™æ”¹UIï¼‰</span><br>    &lt;A&gt; onPostExecute(resultType)	<span class="hljs-comment">//åå°returnåæ‰§è¡Œ</span><br>    &lt;+&gt; execute()	<span class="hljs-comment">//å¯åŠ¨ä»»åŠ¡</span><br>&#125;<br></code></pre></td></tr></table></figure>
<img src="https://migrate-1301429536.cos.ap-nanjing.myqcloud.com/img/20200916174433.png" alt="å›¾10-2 AsyncTaskæŠ½è±¡æ–¹æ³•ã®å…³ç³»" style="zoom:80%;" />
<h3 id="service-åŸºç¡€"><a class="markdownIt-Anchor" href="#service-åŸºç¡€"></a> Service åŸºç¡€</h3>
<h4 id="service-ç±»"><a class="markdownIt-Anchor" href="#service-ç±»"></a> Service ç±»</h4>
<figure class="highlight kotlin"><figcaption><span>Serviceç±»è§£æ</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Service</span> </span>&#123;<br>    onCreate()	<span class="hljs-comment">//åˆ›å»ºæ—¶è°ƒç”¨ï¼ˆç¬¬ä¸€æ¬¡&lt;Activity&gt;.startService, bindServiceï¼‰</span><br>    onStartCommand(intent: Intent, flags: <span class="hljs-built_in">Int</span>, startId: <span class="hljs-built_in">Int</span>)	<span class="hljs-comment">//å¯åŠ¨æ—¶è°ƒç”¨(startServi...)</span><br>    onDestroy()	<span class="hljs-comment">//é”€æ¯æ—¶è°ƒç”¨(stopService, unbindService)</span><br>    onBind(): IBinder <span class="hljs-comment">//è¿”å›ä¸€ä¸ªç»‘å®šæ¥å£ä¾¿äºActivityä¸Serviceäº¤äº’</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="åˆ›å»º-å¯åŠ¨ä¸é”€æ¯"><a class="markdownIt-Anchor" href="#åˆ›å»º-å¯åŠ¨ä¸é”€æ¯"></a> åˆ›å»ºã€å¯åŠ¨ä¸é”€æ¯</h4>
<figure class="highlight kotlin"><figcaption><span>Activityä¸­å¯åŠ¨ä¸åœæ­¢Service</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">startServiceBtn.setOnClickListener &#123;<br>    <span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-keyword">this</span>, MyService::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span><br>    startService(intent) <span class="hljs-comment">// å¯åŠ¨Serviceï¼Œä¼šåŒæ—¶è°ƒç”¨&lt;Service&gt;.onCreateå’ŒonStartCommand</span><br>&#125;<br>stopServiceBtn.setOnClickListener &#123;<br>    <span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-keyword">this</span>, MyService::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span><br>    stopService(intent) <span class="hljs-comment">// åœæ­¢Service</span><br></code></pre></td></tr></table></figure>
<h4 id="binder-ç±»"><a class="markdownIt-Anchor" href="#binder-ç±»"></a> Binder ç±»</h4>
<p>ç»§æ‰¿ä¸€ä¸ªBinderï¼Œåœ¨ç±»ä¸­ç¼–å†™è‡ªå·±çš„å‡½æ•°ï¼Œé€šè¿‡onBind() è¿”å›è¯¥å®ä¾‹ç»™Activityï¼ŒActivityä¸­è°ƒç”¨è¯¥å®ä¾‹çš„æ–¹æ³•ä»¥å®ç°Activityä¸Serviceçš„é€šä¿¡</p>
<div class="mermaid">
classDiagram
class IBinder
&lt&ltinterface&gt&gt IBinder
class MyBinder {
	&lt&ltè‡ªå®šä¹‰&gt&gt
}
IBinder <|-- Binder
Binder <|-- MyBinder
</div>
<h4 id="serviceconnection-ç±»"><a class="markdownIt-Anchor" href="#serviceconnection-ç±»"></a> ServiceConnection ç±»</h4>
<div class="mermaid">
classDiagram
class ServiceConnection {
	onServiceConnected(ComponentName name, IBinder service)
	onServiceDisconnected(ComponentName name)
}
</div>
<h4 id="ç»‘å®š"><a class="markdownIt-Anchor" href="#ç»‘å®š"></a> ç»‘å®š</h4>
<figure class="highlight kotlin"><figcaption><span>ç»‘å®šç¤ºä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() &#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    lateinit var downloadBinder: MyService.DownloadBinder</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    private val connection = object : ServiceConnection &#123;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        override fun onServiceConnected(name: ComponentName, service: IBinder) &#123;</span><br><span class="hljs-comment">            downloadBinder = service as MyService.DownloadBinder</span><br><span class="hljs-comment">            downloadBinder.startDownload()</span><br><span class="hljs-comment">            downloadBinder.getProgress()</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        override fun onServiceDisconnected(name: ComponentName) &#123;</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    &#125;*/</span><br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        â€¦<br>        bindServiceBtn.setOnClickListener &#123;<br>            <span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-keyword">this</span>, MyService::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span><br>            bindService(intent, connection, Context.BIND_AUTO_CREATE) <span class="hljs-comment">// ç»‘å®šService</span><br>        &#125;<br>        unbindServiceBtn.setOnClickListener &#123;<br>            unbindService(connection) <span class="hljs-comment">// è§£ç»‘Service</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="service-ç”Ÿå‘½å‘¨æœŸ"><a class="markdownIt-Anchor" href="#service-ç”Ÿå‘½å‘¨æœŸ"></a> Service ç”Ÿå‘½å‘¨æœŸ</h4>
<div class="mermaid">
flowchart TB
è°ƒç”¨äº†næ¬¡startService -->|åœæ­¢æœåŠ¡| 1æ¬¡stopService
æ—¢è°ƒç”¨äº†startServiceåˆè°ƒç”¨äº†bindService -->|åœæ­¢æœåŠ¡| stopService+unbindService
A(åŒä¸€ä¸ªServiceç±»åªä¼šå­˜åœ¨ä¸€ä¸ªå®ä¾‹)
</div>
<h4 id="å‰å°æœåŠ¡-foreground"><a class="markdownIt-Anchor" href="#å‰å°æœåŠ¡-foreground"></a> å‰å°æœåŠ¡ Foreground</h4>
<blockquote>
<p>å‰å°Serviceå’Œæ™®é€šServiceæœ€å¤§çš„åŒºåˆ«å°±åœ¨äºï¼Œå®ƒä¼šä¸€ç›´æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å›¾æ ‡åœ¨ç³»ç»Ÿçš„çŠ¶æ€æ æ˜¾ç¤ºï¼Œä¸‹æ‹‰çŠ¶æ€æ åå¯ä»¥çœ‹åˆ°æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯ï¼Œéå¸¸ç±»ä¼¼äºé€šçŸ¥çš„æ•ˆæœã€‚</p>
<p>ç”±äºçŠ¶æ€æ ä¸­ä¸€ç›´æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å›¾æ ‡ï¼Œç›¸å½“äºæˆ‘ä»¬çš„åº”ç”¨ä»¥å¦å¤–ä¸€ç§å½¢å¼ä¿æŒåœ¨å‰å°å¯è§çŠ¶æ€ï¼Œæ‰€ä»¥ç³»ç»Ÿä¸ä¼šå€¾å‘äºå›æ”¶å‰å°Serviceã€‚</p>
</blockquote>
<p>å¯ç”¨æ–¹å¼ï¼šåœ¨<code>&lt;Service&gt;.onCreat()</code>ä¸­åˆ›å»ºä¸€æ¡é€šçŸ¥ï¼Œå¤§ä½“ä¸Šä¸1.1ä¸­åˆ›å»ºé€šçŸ¥çš„æ–¹å¼ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯ä¸ç”¨é€šçŸ¥ç®¡ç†å™¨å‘é€é€šçŸ¥è€Œæ˜¯ä»¥startForeground(â€¦)å‘é€é€šçŸ¥ã€‚</p>
<figure class="highlight xml"><figcaption><span>åº”ç”¨å¼€å¯å‰å°æœåŠ¡æƒé™</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">          <span class="hljs-attr">package</span>=<span class="hljs-string">"com.example.servicetest"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.FOREGROUND_SERVICE"</span> /&gt;</span><br>    â€¦<br><span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight kotlin"><figcaption><span>å‰å°æœåŠ¡å®ä¾‹</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyService</span> : <span class="hljs-type">Service</span></span>() &#123;<br>    â€¦<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate()<br>        <span class="hljs-keyword">val</span> manager = getSystemService(Context.NOTIFICATION_SERVICE) asNotificationManager<br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;<br>            <span class="hljs-keyword">val</span> channel = NotificationChannel(<span class="hljs-string">"my_service"</span>, <span class="hljs-string">"å‰å°Serviceé€šçŸ¥"</span>, NotificationManager.IMPORTANCE_DEFAULT)<br>            manager.createNotificationChannel(channel)<br>        &#125;<br>        <span class="hljs-keyword">val</span> intent = Intent(<span class="hljs-keyword">this</span>, MainActivity::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span><br>        <span class="hljs-keyword">val</span> pi = PendingIntent.getActivity(<span class="hljs-keyword">this</span>, <span class="hljs-number">0</span>, intent, <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">val</span> notification = NotificationCompat.Builder(<span class="hljs-keyword">this</span>, <span class="hljs-string">"my_service"</span>)<br>            .setContentTitle(<span class="hljs-string">"This is content title"</span>)<br>            .setContentText(<span class="hljs-string">"This is content text"</span>)<br>            .setSmallIcon(R.drawable.small_icon)<br>            .setLargeIcon(BitmapFactory.decodeResource(resources, R.drawable.large_icon))<br>            .setContentIntent(pi)<br>            .build()<br>        startForeground(<span class="hljs-number">1</span>, notification)<br>    &#125;<br>    â€¦<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="intentservice-ç±»"><a class="markdownIt-Anchor" href="#intentservice-ç±»"></a> IntentService ç±»</h4>
<div class="mermaid">
classDiagram
class IntentService {
	&lt&ltAbstract&gt&gt
	onHandleIntent(Intent intent)*
}
class MyIntentService {
	&lt&ltè‡ªå®šä¹‰&gt&gt
}
class Service {
	&lt&ltAbstract&gt&gt
}
Service <|-- IntentService
IntentService <|-- MyIntentService
</div>
<ul>
<li>ä½œç”¨ï¼šè‡ªåŠ¨å¼€å¯çº¿ç¨‹ã€è‡ªåŠ¨åœæ­¢æœåŠ¡</li>
</ul>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Android/">Android</a><a class="link-muted mr-2" rel="tag" href="/tags/Kotlin/">Kotlin</a></div><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5ed1b54839d71d24" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Ÿæ‰“èµä¸€ä¸‹ä½œè€…å§</h3><div class="buttons is-centered"><a class="button donate" href="https://www.buymeacoffee.com/Weiliang" style="background-color:rgba(255,128,62,.87);border-color:transparent;color:white;" target="_blank" rel="noopener"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>é€æ¯å’–å•¡</span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>å¾®ä¿¡æ‰“èµ</span><span class="qrcode"><img src="/img/wechat/qrcode.png" alt="å¾®ä¿¡æ‰“èµ"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/77d3606/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ç®—æ³•/ç®—æ³•åˆ†æä¸è®¾è®¡</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/c484d1a3/"><span class="level-item">æŠ€æœ¯/ç¬”è®°/ã€Šç¬¬ä¸€è¡Œä»£ç ï¼šAndroidã€‹è¯»ä¹¦ç¬”è®° (äºŒ)</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">ç›®å½•</h3><ul class="menu-list"><li><a class="is-flex" href="#ä¸°å¯Œå¤šå½©çš„å¤šåª’ä½“"><span class="mr-2">1</span><span> ä¸°å¯Œå¤šå½©çš„å¤šåª’ä½“</span></a><ul class="menu-list"><li><a class="is-flex" href="#ä½¿ç”¨é€šçŸ¥"><span class="mr-2">1.1</span><span> ä½¿ç”¨é€šçŸ¥</span></a><ul class="menu-list"><li><a class="is-flex" href="#æ¦‚è§ˆ"><span class="mr-2">1.1.1</span><span> æ¦‚è§ˆ</span></a></li><li><a class="is-flex" href="#notificationmanager-ç±»"><span class="mr-2">1.1.2</span><span> NotificationManager ç±»</span></a></li><li><a class="is-flex" href="#notificationchannel-ç±»"><span class="mr-2">1.1.3</span><span> NotificationChannel ç±»</span></a></li><li><a class="is-flex" href="#notification-ç±»"><span class="mr-2">1.1.4</span><span> Notification ç±»</span></a></li><li><a class="is-flex" href="#ç‚¹å‡»äº‹ä»¶"><span class="mr-2">1.1.5</span><span> ç‚¹å‡»äº‹ä»¶</span></a></li></ul></li><li><a class="is-flex" href="#è°ƒç”¨æ‘„åƒå¤´ä¸ç›¸å†Œ"><span class="mr-2">1.2</span><span> è°ƒç”¨æ‘„åƒå¤´ä¸ç›¸å†Œ</span></a><ul class="menu-list"><li><a class="is-flex" href="#from-camera"><span class="mr-2">1.2.1</span><span> From Camera</span></a></li><li><a class="is-flex" href="#from-album"><span class="mr-2">1.2.2</span><span> From Album</span></a></li></ul></li><li><a class="is-flex" href="#æ’­æ”¾å¤šåª’ä½“æ–‡ä»¶"><span class="mr-2">1.3</span><span> æ’­æ”¾å¤šåª’ä½“æ–‡ä»¶</span></a><ul class="menu-list"><li><a class="is-flex" href="#éŸ³é¢‘æ¦‚è§ˆ"><span class="mr-2">1.3.1</span><span> éŸ³é¢‘æ¦‚è§ˆ</span></a></li><li><a class="is-flex" href="#mediaplayer-ç±»"><span class="mr-2">1.3.2</span><span> MediaPlayer ç±»</span></a></li><li><a class="is-flex" href="#assetmanager-ç±»"><span class="mr-2">1.3.3</span><span> AssetManager ç±»</span></a></li><li><a class="is-flex" href="#éŸ³é¢‘ç¤ºä¾‹"><span class="mr-2">1.3.4</span><span> éŸ³é¢‘ç¤ºä¾‹</span></a></li><li><a class="is-flex" href="#è§†é¢‘æ¦‚è®º"><span class="mr-2">1.3.5</span><span> è§†é¢‘æ¦‚è®º</span></a></li><li><a class="is-flex" href="#è§†é¢‘å®ä¾‹"><span class="mr-2">1.3.6</span><span> è§†é¢‘å®ä¾‹</span></a></li></ul></li></ul></li><li><a class="is-flex" href="#åå°é»˜é»˜åŠ³åŠ¨è€…-service"><span class="mr-2">2</span><span> åå°é»˜é»˜åŠ³åŠ¨è€… Service</span></a><ul class="menu-list"><li><a class="is-flex" href="#å®‰å“å¤šçº¿ç¨‹"><span class="mr-2">2.1</span><span> å®‰å“å¤šçº¿ç¨‹</span></a><ul class="menu-list"><li><a class="is-flex" href="#kotlin-å¤šçº¿ç¨‹ç¼–ç¨‹"><span class="mr-2">2.1.1</span><span> Kotlin å¤šçº¿ç¨‹ç¼–ç¨‹</span></a></li><li><a class="is-flex" href="#å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶"><span class="mr-2">2.1.2</span><span> å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶</span></a></li><li><a class="is-flex" href="#asynctask-ç±»"><span class="mr-2">2.1.3</span><span> AsyncTask ç±»</span></a></li></ul></li><li><a class="is-flex" href="#service-åŸºç¡€"><span class="mr-2">2.2</span><span> Service åŸºç¡€</span></a><ul class="menu-list"><li><a class="is-flex" href="#service-ç±»"><span class="mr-2">2.2.1</span><span> Service ç±»</span></a></li><li><a class="is-flex" href="#åˆ›å»º-å¯åŠ¨ä¸é”€æ¯"><span class="mr-2">2.2.2</span><span> åˆ›å»ºã€å¯åŠ¨ä¸é”€æ¯</span></a></li><li><a class="is-flex" href="#binder-ç±»"><span class="mr-2">2.2.3</span><span> Binder ç±»</span></a></li><li><a class="is-flex" href="#serviceconnection-ç±»"><span class="mr-2">2.2.4</span><span> ServiceConnection ç±»</span></a></li><li><a class="is-flex" href="#ç»‘å®š"><span class="mr-2">2.2.5</span><span> ç»‘å®š</span></a></li><li><a class="is-flex" href="#service-ç”Ÿå‘½å‘¨æœŸ"><span class="mr-2">2.2.6</span><span> Service ç”Ÿå‘½å‘¨æœŸ</span></a></li><li><a class="is-flex" href="#å‰å°æœåŠ¡-foreground"><span class="mr-2">2.2.7</span><span> å‰å°æœåŠ¡ Foreground</span></a></li><li><a class="is-flex" href="#intentservice-ç±»"><span class="mr-2">2.2.8</span><span> IntentService ç±»</span></a></li></ul></li></ul></li></ul></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/William_blog.png" alt="William@blog" height="28"></a><p class="size-small"><span>&copy; 2022 Weiliang Bai</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="ğŸ»Xiong35" href="http://www.xiong35.cn"><i class="fas fa-paw"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="ğŸƒLam" href="https://lamcoding.github.io"><i class="fas fa-leaf"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://willog.top',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fa fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="ğŸ˜†éšä¾¿æœç‚¹ä»€ä¹ˆå‘—..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"ğŸ˜†éšä¾¿æœç‚¹ä»€ä¹ˆå‘—...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>